{% extends "base.html" %}

{% block preload %}
<link rel="preload" href="/fonts/iAWriterDuospace-Regular.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/iAWriterDuospace-Italic.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/iAWriterDuospace-Bold.woff2" as="font" type="font/woff2" crossorigin>
{% endblock preload %}

{% block content %}
{% if page %}

    {% set parent = get_section(path=page.ancestors | last) %}
    {% if parent.pages | length > 1 %}
    <nav class="toc" id="toc" aria-label="Table of contents">
        <a class="skip" href="#content">Skip to content</a>
        <ol role="list">
            <li><span class="title">{{ parent.title }}</span></li>
            {% for chapter in parent.pages %}
            {% if current_url == chapter.permalink %}
            <li><a class="active" href="{{ chapter.permalink }}" aria-current="page">{{ chapter.title }}</a></li>
            {% else %}
            <li><a href="{{ chapter.permalink }}">{{ chapter.title }}</a></li>
            {% endif %}
            {% endfor %}
        </ol>
    </nav>
    {% endif %}

    <article id="content">
        <header>
            <h1 class="title">{{ page.title }}</h1>
            <aside class="meta dim">
                <time datetime="{{ page.date }}">Posted on {{ page.date | date(format='%B %_d, %Y') }}</time>
                <p class="readtime">{{ page.reading_time }} minute{{ page.reading_time | pluralize }}</p>
            </aside>
        </header>
    
        <div class="chapter">
        {{ page.content | safe }}
        </div>
    </article>

    <nav class="pagination" aria-label="Pagination">
        {% if page.lower %}
        <a class="previous" href="{{ page.lower.permalink }}"><span class="sr-hidden" role="presentation">←</span> {{ page.lower.title }}</a>
        {% endif %}

        <a class="index" href="{{ parent.permalink }}">{{ parent.title }}</a>

        {% if page.higher %}
        <a class="next" href="{{ page.higher.permalink }}">{{ page.higher.title }} <span class="sr-hidden" role="presentation">→</span></a>
        {% endif %}
    </nav>

{% else %}

    <article id="content">
    <h1 class="title">{{ section.title }}</h1>
    <aside class="meta dim">
        <time datetime="{{ page.date }}">Posted on {{ page.date | date(format='%B %_d, %Y') }}</time>
        <p class="readtime">{{ page.reading_time }} minute{{ page.reading_time | pluralize }}</p>
    </aside>

    <div class="chapter">
        {{ section.content | safe }}
    </div>
    </article>

    {% set index = get_section(path="@/fics/_index.md") %}
    <a href="{{ index.permalink }}">{{ index.title }}</a>

{% endif %}
{% endblock content %}